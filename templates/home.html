<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>控制台 - RustDeskApi</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/global.css' %}">
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
    <link rel="stylesheet" href="{% static 'css/nav1.css' %}">
    <link rel="stylesheet" href="{% static 'css/nav2.css' %}">
    <style>
        /* Toast 轻量样式（仅此页使用） */
        .toast-container {
            position: fixed;
            top: 16px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center
        }

        .toast {
            min-width: 100px;
            max-width: 80vw;
            color: #fff;
            border-radius: 6px;
            padding: 10px 16px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, .2);
            opacity: 0;
            transform: translateY(-6px);
            transition: opacity .18s ease, transform .18s ease;
            text-align: center;
            word-wrap: break-word;
            word-break: break-word;
            white-space: normal;
            width: auto
        }

        .toast--show {
            opacity: 1;
            transform: translateY(0)
        }

        .toast--error {
            background: rgba(185, 28, 28, .95)
        }

        .toast--success {
            background: rgba(22, 163, 74, .95)
        }

        .toast--info {
            background: rgba(37, 99, 235, .95)
        }
    </style>
</head>
<body data-current-user="{{ user.username }}">
<header class="header">
    <div class="title">控制台</div>
    <div class="user-actions">
        <span>欢迎，{{ username }}！</span>
        <a href="{% url 'web_logout' %}">退出登录</a>
    </div>
</header>
<div class="layout">
    <aside class="sidebar" role="navigation" aria-label="侧边导航">
        <div class="brand">导航</div>
        <nav>
            <ul class="nav">
                <li><a href="#" data-key="nav-1">首页</a></li>
                <li><a href="#" data-key="nav-2">设备管理</a></li>
                <li><a href="#" data-key="nav-3">用户管理</a></li>
                <li><a href="#" data-key="nav-4">地址簿</a></li>
            </ul>
        </nav>
    </aside>
    <main id="content" class="content" role="main" aria-live="polite" aria-busy="false">
        <div class="content-empty" id="empty-hint">请选择左侧的一个导航项以查看内容</div>
    </main>
</div>

<!-- 添加设备到地址簿弹框 -->
<div id="nav2-add-to-book-root" class="modal-backdrop" aria-hidden="true">
    <div class="modal modal--sm" role="dialog" aria-modal="true" aria-labelledby="nav2-add-to-book-title">
        <div class="modal-header">
            <h3 id="nav2-add-to-book-title" class="modal-title">添加设备到地址簿</h3>
            <button type="button" class="modal-close" data-close="nav2-add-to-book" aria-label="关闭">
                <img src="{% static 'icons/close.svg' %}" width="16" height="16" alt="" aria-hidden="true">
            </button>
        </div>
        <div class="modal-body">
            <form id="nav2-add-to-book-form">
                <input type="hidden" name="peer_id" id="nav2-add-to-book-peer-id">
                <div class="nav2-form-row">
                    <label style="min-width:88px;color:#6a737d;">设备ID</label>
                    <span id="nav2-add-to-book-peer-id-display" style="color:#24292e;"></span>
                </div>
                <div class="nav2-form-row">
                    <label for="nav2-add-to-book-guid" style="min-width:88px;color:#6a737d;">选择地址簿</label>
                    <select class="nav2-select" name="guid" id="nav2-add-to-book-guid" required style="flex:1;">
                        <option value="" disabled selected hidden>请选择地址簿</option>
                    </select>
                </div>
                <div class="nav2-form-row">
                    <label for="nav2-add-to-book-alias" style="min-width:88px;color:#6a737d;">设备别名</label>
                    <input class="nav2-input nav2-input-full" type="text" name="alias" id="nav2-add-to-book-alias"
                           placeholder="请输入设备别名(可选)">
                </div>
                <div style="display:flex;gap:8px;justify-content:flex-end;">
                    <button type="button" class="nav2-btn" data-close="nav2-add-to-book">取消</button>
                    <button type="submit" class="nav2-btn nav2-primary">添加</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- 引入模块化的 JavaScript 文件 -->
<script src="{% static 'js/constants.js' %}"></script>
<script src="{% static 'js/utils.js' %}"></script>
<script src="{% static 'js/modal.js' %}"></script>
<script src="{% static 'js/navigation.js' %}"></script>
<script src="{% static 'js/nav2.js' %}"></script>
<script src="{% static 'js/nav3.js' %}"></script>
<script src="{% static 'js/nav4.js' %}"></script>
<script src="{% static 'js/events.js' %}"></script>

<!-- Django 模板变量注入（< 50 行） -->
<script>
    /**
     * Django 模板变量注入到全局命名空间
     *
     * 仅在此处注入需要Django模板标签渲染的URL和配置
     * 所有业务逻辑代码已移至独立的JS模块
     */
    (function () {
        'use strict';

        // 注入 URL 常量
        window.APP.URLS = {
            NAV_CONTENT: "{% url 'web_nav_content' %}",
            RENAME_ALIAS: "{% url 'web_rename_alias' %}",
            DEVICE_DETAIL: "{% url 'web_device_detail' %}",
            DEVICE_UPDATE: "{% url 'web_device_update' %}",
            DEVICE_STATUSES: "{% url 'web_device_statuses' %}",
            USER_UPDATE: "{% url 'web_user_update' %}",
            USER_RESET_PWD: "{% url 'web_user_reset_password' %}",
            USER_DELETE: "{% url 'web_user_delete' %}",
            USER_CREATE: "{% url 'web_user_create' %}",
            PERSONAL_LIST: "{% url 'web_personal_list' %}",
            PERSONAL_CREATE: "{% url 'web_personal_create' %}",
            PERSONAL_DELETE: "{% url 'web_personal_delete' %}",
            PERSONAL_RENAME: "{% url 'web_personal_rename' %}",
            PERSONAL_DETAIL: "{% url 'web_personal_detail' %}",
            PERSONAL_ADD_DEVICE: "{% url 'web_personal_add_device' %}",
            PERSONAL_REMOVE_DEVICE: "{% url 'web_personal_remove_device' %}",
            PERSONAL_UPDATE_ALIAS: "{% url 'web_personal_update_alias' %}",
            PERSONAL_UPDATE_TAGS: "{% url 'web_personal_update_tags' %}",
            LOGIN: "{% url 'web_login' %}",
            HOME: "{% url 'web_home' %}"
        };

        // 应用初始化
        document.addEventListener('DOMContentLoaded', function () {
            APP.navigation.init();
            APP.events.init();
        });
    })();
</script>

</body>
</html>
