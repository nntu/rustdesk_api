<!-- 地址簿管理页面，样式共用 nav2 样式 -->
{% load static %}

<div class="nav2-section-title">Quản lý sổ địa chỉ</div>
<div class="nav2-toolbar" aria-label="Thanh công cụ sổ địa chỉ">
    <form id="nav4-search-form" role="search" aria-label="Bộ lọc tìm kiếm sổ địa chỉ">
        <input class="nav2-input" type="text" name="q" value="{{ q|default:'' }}" placeholder="Tìm kiếm GUID sổ địa chỉ"
               aria-label="Từ khóa tìm kiếm">
        <select class="nav2-select" name="type" aria-label="Loại sổ địa chỉ">
            <option value="" {% if not personal_type %}selected{% endif %}>Tất cả loại</option>
            <option value="private" {% if personal_type == 'private' %}selected{% endif %}>Riêng tư</option>
            <option value="public" {% if personal_type == 'public' %}selected{% endif %}>Công khai</option>
        </select>
        <button type="submit" class="nav2-btn nav2-primary">Tìm kiếm</button>
        <button type="button" class="nav2-btn nav4-reset-btn">Đặt lại</button>
    </form>
    <div style="margin-left:auto;">
        <button type="button" class="nav2-btn nav2-primary nav4-create-btn">Tạo sổ địa chỉ mới</button>
    </div>
</div>

{% if personals %}
    <div class="x-scroll-container">
        <table class="nav2-table" aria-label="Danh sách sổ địa chỉ" data-table-id="nav4-personals">
            <thead>
            <tr>
                <th data-col-key="personal_name" style="width: 250px;">Tên sổ địa chỉ</th>
                <!-- <th data-col-key="guid" style="width: 280px;">GUID</th> -->
                <th data-col-key="personal_type" style="width: 100px;">Loại</th>
                <th data-col-key="device_count" style="width: 120px;">Số lượng thiết bị</th>
                <th data-col-key="created_at" style="width: 180px;">Thời gian tạo</th>
                <th data-col-key="actions" style="width: 250px;">Thao tác</th>
            </tr>
            </thead>
            <tbody>
            {% for p in personals %}
                <tr data-guid="{{ p.guid }}">
                    <td>{{ p.display_name }}</td>
                    <!-- <td><code style="font-size:12px;">{{ p.guid }}</code></td> -->
                    <td>
                        {% if p.personal_type == 'public' %}
                            <span class="nav2-status online">Công khai</span>
                        {% else %}
                            <span class="nav2-status offline">Riêng tư</span>
                        {% endif %}
                    </td>
                    <td>{{ p.device_count|default:0 }}</td>
                    <td>{{ p.created_at|date:"Y-m-d H:i:s" }}</td>
                    <td>
                        <div class="nav2-row-actions">
                            <button type="button"
                                    class="nav2-link nav4-row-action"
                                    data-action="view"
                                    data-guid="{{ p.guid }}"
                                    data-name="{{ p.personal_name }}">Xem
                            </button>
                            {% if not p.is_default %}
                                <button type="button"
                                        class="nav2-link nav4-row-action"
                                        data-action="rename"
                                        data-guid="{{ p.guid }}"
                                        data-name="{{ p.personal_name }}">Đổi tên
                                </button>
                                <button type="button"
                                        class="nav2-link nav4-row-action"
                                        data-action="delete"
                                        data-guid="{{ p.guid }}"
                                        data-name="{{ p.personal_name }}">Xóa
                                </button>
                            {% endif %}
                        </div>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="nav2-pagination">
        <button class="nav2-btn nav4-page-btn" data-key="nav-4"
                {% if page_obj.has_previous %}data-page="{{ page_obj.previous_page_number }}"{% else %}data-page=""
                disabled{% endif %}>Trang trước
        </button>
        <span style="color:#6a737d;">Trang {{ page_obj.number }} / {{ paginator.num_pages }} (tổng {{ paginator.count }} bản ghi)</span>
        <button class="nav2-btn nav4-page-btn" data-key="nav-4"
                {% if page_obj.has_next %}data-page="{{ page_obj.next_page_number }}"{% else %}data-page=""
                disabled{% endif %}>Trang sau
        </button>
    </div>
{% else %}
    <div class="nav2-empty">Chưa có dữ liệu sổ địa chỉ</div>
{% endif %}

<!-- 新建地址簿弹框 -->
<div id="nav4-create-root" class="modal-backdrop" aria-hidden="true">
    <div class="modal modal--sm" role="dialog" aria-modal="true" aria-labelledby="nav4-create-title">
        <div class="modal-header">
            <h3 id="nav4-create-title" class="modal-title">Tạo sổ địa chỉ mới</h3>
            <button type="button" class="modal-close" data-close="nav4-create" aria-label="Đóng">
                <img src="/static/icons/close.svg" width="16" height="16" alt="" aria-hidden="true">
            </button>
        </div>
        <div class="modal-body">
            <form id="nav4-create-form">
                <div class="nav2-form-row">
                    <label for="nav4-create-name" style="min-width:88px;color:#6a737d;">Tên sổ địa chỉ</label>
                    <input class="nav2-input nav2-input-full" type="text" name="personal_name" id="nav4-create-name"
                           placeholder="Vui lòng nhập tên sổ địa chỉ" required>
                </div>
                {#                <div class="nav2-form-row">#}
                {#                    <label for="nav4-create-type" style="min-width:88px;color:#6a737d;">Loại</label>#}
                {#                    <select class="nav2-select" name="personal_type" id="nav4-create-type">#}
                {#                        <option value="private" selected>Riêng tư</option>#}
                {#                        <option value="public">Công khai</option>#}
                {#                    </select>#}
                {#                </div>#}
                <div style="display:flex;gap:8px;justify-content:flex-end;">
                    <button type="button" class="nav2-btn" data-close="nav4-create">Hủy</button>
                    <button type="submit" class="nav2-btn nav2-primary">Tạo</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- 重命名地址簿弹框 -->
<div id="nav4-rename-root" class="modal-backdrop" aria-hidden="true">
    <div class="modal modal--sm" role="dialog" aria-modal="true" aria-labelledby="nav4-rename-title">
        <div class="modal-header">
            <h3 id="nav4-rename-title" class="modal-title">Đổi tên sổ địa chỉ</h3>
            <button type="button" class="modal-close" data-close="nav4-rename" aria-label="Đóng">
                <img src="/static/icons/close.svg" width="16" height="16" alt="" aria-hidden="true">
            </button>
        </div>
        <div class="modal-body">
            <form id="nav4-rename-form">
                <input type="hidden" name="guid" id="nav4-rename-guid">
                <div class="nav2-form-row">
                    <label for="nav4-rename-name" style="min-width:88px;color:#6a737d;">Tên mới</label>
                    <input class="nav2-input nav2-input-full" type="text" name="new_name" id="nav4-rename-name"
                           placeholder="Vui lòng nhập tên mới" required>
                </div>
                <div style="display:flex;gap:8px;justify-content:flex-end;">
                    <button type="button" class="nav2-btn" data-close="nav4-rename">Hủy</button>
                    <button type="submit" class="nav2-btn nav2-primary">Lưu</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- 地址簿详情弹框 -->
<div id="nav4-detail-root" class="modal-backdrop" aria-hidden="true">
    <div class="modal modal--lg" role="dialog" aria-modal="true" aria-labelledby="nav4-detail-title">
        <div class="modal-header">
            <h3 id="nav4-detail-title" class="modal-title">Chi tiết sổ địa chỉ</h3>
            <button type="button" class="modal-close" data-close="nav4-detail" aria-label="Đóng">
                <img src="/static/icons/close.svg" width="16" height="16" alt="" aria-hidden="true">
            </button>
        </div>
        <div class="modal-body" id="nav4-detail-body">
            <!-- 动态填充 -->
        </div>
    </div>
</div>

<!-- 添加设备到地址簿弹框 -->
<div id="nav4-add-device-root" class="modal-backdrop" aria-hidden="true">
    <div class="modal modal--sm" role="dialog" aria-modal="true" aria-labelledby="nav4-add-device-title">
        <div class="modal-header">
            <h3 id="nav4-add-device-title" class="modal-title">Thêm thiết bị vào sổ địa chỉ</h3>
            <button type="button" class="modal-close" data-close="nav4-add-device" aria-label="Đóng">
                <img src="/static/icons/close.svg" width="16" height="16" alt="" aria-hidden="true">
            </button>
        </div>
        <div class="modal-body">
            <form id="nav4-add-device-form">
                <input type="hidden" name="guid" id="nav4-add-device-guid">
                <input type="hidden" name="peer_id" id="nav4-add-device-peer-id">
                <div class="nav2-form-row">
                    <label style="min-width:88px;color:#6a737d;">ID thiết bị</label>
                    <span id="nav4-add-device-peer-id-display" style="color:#24292e;"></span>
                </div>
                <div class="nav2-form-row">
                    <label for="nav4-add-device-alias" style="min-width:88px;color:#6a737d;">Biệt danh thiết bị</label>
                    <input class="nav2-input nav2-input-full" type="text" name="alias" id="nav4-add-device-alias"
                           placeholder="Vui lòng nhập biệt danh thiết bị (tùy chọn)">
                </div>
                <div style="display:flex;gap:8px;justify-content:flex-end;">
                    <button type="button" class="nav2-btn" data-close="nav4-add-device">Hủy</button>
                    <button type="submit" class="nav2-btn nav2-primary">Thêm</button>
                </div>
            </form>
        </div>
    </div>
</div>

