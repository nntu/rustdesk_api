<!-- Stylesheet được cung cấp bởi CSS tĩnh trong head của trang chủ -->
{% load static %}

<div class="nav2-section-title">Quản lý thiết bị</div>
<div class="nav2-toolbar" aria-label="Thanh công cụ thiết bị">
    <form id="nav2-search-form" role="search" aria-label="Tìm kiếm thiết bị">
        <input class="nav2-input" type="text" name="q" value="{{ q|default:'' }}" placeholder="Tìm kiếm ID/Tên thiết bị"
               aria-label="Từ khóa tìm kiếm">
        <select class="nav2-select" name="os" aria-label="Hệ điều hành">
            <option value="" {% if not os %}selected{% endif %}>Tất cả hệ điều hành</option>
            <option value="Windows" {% if os == 'Windows' %}selected{% endif %}>Windows</option>
            <option value="macOS" {% if os == 'macOS' %}selected{% endif %}>macOS</option>
            <option value="Linux" {% if os == 'Linux' %}selected{% endif %}>Linux</option>
            <option value="Android" {% if os == 'Android' %}selected{% endif %}>Android</option>
            <option value="iOS" {% if os == 'iOS' %}selected{% endif %}>iOS</option>
        </select>
        <select class="nav2-select" name="status" aria-label="Trạng thái trực tuyến">
            <option value="" {% if not status %}selected{% endif %}>Tất cả trạng thái</option>
            <option value="online" {% if status == 'online' %}selected{% endif %}>Trực tuyến</option>
            <option value="offline" {% if status == 'offline' %}selected{% endif %}>Ngoại tuyến</option>
        </select>
        <button type="submit" class="nav2-btn nav2-primary">Tìm kiếm</button>
        <button type="button" class="nav2-btn nav2-reset-btn">Đặt lại</button>
    </form>
    {#    <div class="nav2-toolbar-actions" aria-label="Thao tác hàng loạt">#}
    {#        <button type="button" class="nav2-btn nav2-bulk-btn" data-action="enable">Bật hàng loạt</button>#}
    {#        <button type="button" class="nav2-btn nav2-bulk-btn" data-action="disable">Tắt hàng loạt</button>#}
    {#        <button type="button" class="nav2-btn nav2-bulk-btn nav2-danger" data-action="delete">Xóa hàng loạt</button>#}
    {#        <button type="button" class="nav2-btn nav2-bulk-btn" data-action="export">Xuất danh sách</button>#}
    {#    </div>#}
    <!-- Có thể thêm: Tạo thiết bị/Nhập dữ liệu theo nhu cầu -->
    <!-- <button type="button" class="nav2-btn">Tạo thiết bị</button> -->
    <!-- <button type="button" class="nav2-btn">Nhập</button> -->
</div>

{% if devices %}
    <div class="x-scroll-container">
        <table class="nav2-table" aria-label="Danh sách thiết bị" data-table-id="nav2-devices">
        <thead>
        <tr>
            <th data-col-key="select" style="width: 30px;">
                <input type="checkbox" id="nav2-select-all" aria-label="Chọn tất cả thiết bị">
            </th>
            <th data-col-key="peer_id" style="width: 120px;">ID thiết bị</th>
            <th data-col-key="device_name" style="width: 170px;">Tên thiết bị</th>
            <th data-col-key="os" style="width: 120px;">Hệ điều hành</th>
            <th data-col-key="status" style="width: 100px;">Trạng thái</th>
            <th data-col-key="version" style="width: 120px;">Phiên bản</th>
            <th data-col-key="created_at" style="width: 180px;">Thời gian tạo</th>
            <th data-col-key="actions" style="width: 150px;">Thao tác</th>
        </tr>
        </thead>
        <tbody>
        {% for d in devices %}
            <tr data-peer-id="{{ d.peer_id }}">
                <td>
                    <input type="checkbox" class="nav2-row-checkbox" value="{{ d.peer_id }}"
                           aria-label="Chọn thiết bị {{ d.peer_id }}">
                </td>
                <td>{{ d.peer_id }}</td>
                <td>{{ d.device_name }}</td>
                <td>{{ d.os }}</td>
                <td>
                    {% if d.is_online %}
                        <span class="nav2-status online" data-status-for="{{ d.peer_id }}">Trực tuyến</span>
                    {% else %}
                        <span class="nav2-status offline" data-status-for="{{ d.peer_id }}">Ngoại tuyến</span>
                    {% endif %}
                </td>
                <td>{{ d.version }}</td>
                <td>{{ d.created_at|date:"Y-m-d H:i:s" }}</td>
                <td>
                    <div class="nav2-row-actions">
                        <button type="button" class="nav2-link nav2-row-action" data-action="add_to_book"
                                data-id="{{ d.peer_id }}">Thêm vào sổ địa chỉ
                        </button>
                    </div>
                </td>
            </tr>
        {% endfor %}
        </tbody>
        </table>
    </div>
    <div class="nav2-pagination">
        <button class="nav2-btn nav2-page-btn" data-key="nav-2"
                {% if page_obj.has_previous %}data-page="{{ page_obj.previous_page_number }}"{% else %}data-page=""
                disabled{% endif %}>Trang trước
        </button>
        <span style="color:#6a737d;">Trang {{ page_obj.number }} / {{ paginator.num_pages }} (tổng {{ paginator.count }})</span>
        <button class="nav2-btn nav2-page-btn" data-key="nav-2"
                {% if page_obj.has_next %}data-page="{{ page_obj.next_page_number }}"{% else %}data-page=""
                disabled{% endif %}>Trang sau
        </button>
        <!-- Dựng điều khiển kích thước trang (kích hoạt khi backend hỗ trợ)
    <select class="nav2-select" name="page_size" aria-label="Số mục mỗi trang">
        <option value="10" {% if page_size == 10 %}selected{% endif %}>10</option>
        <option value="20" {% if page_size == 20 %}selected{% endif %}>20</option>
        <option value="50" {% if page_size == 50 %}selected{% endif %}>50</option>
    </select>
    -->
    </div>
{% else %}
    <div class="nav2-empty">Chưa có dữ liệu thiết bị</div>
{% endif %}

<!-- Modal chi tiết (nội dung để trống, điền sau) -->
<div id="nav2-modal-root" class="modal-backdrop" aria-hidden="true">
    <div class="modal modal--md" role="dialog" aria-modal="true" aria-labelledby="nav2-modal-title">
        <div class="modal-header">
            <h3 id="nav2-modal-title" class="modal-title">Chi tiết thiết bị</h3>
            <button type="button" class="modal-close" data-close="nav2-modal" aria-label="Đóng">
                <img src="/static/icons/close.svg" width="16" height="16" alt="" aria-hidden="true">
            </button>
        </div>
        <div class="modal-body" id="nav2-modal-body">
            <!-- Nội dung trống: vui lòng điền trong phần implementation sau -->
        </div>
    </div>
    <!-- Nhấn vào遮罩 để đóng -->
</div>

<!-- Modal đổi tên (gửi backend để sửa alias) -->
<div id="nav2-rename-root" class="modal-backdrop" aria-hidden="true">
    <div class="modal modal--sm" role="dialog" aria-modal="true" aria-labelledby="nav2-rename-title">
        <div class="modal-header">
            <h3 id="nav2-rename-title" class="modal-title">Đổi tên thiết bị</h3>
            <button type="button" class="modal-close" data-close="nav2-rename" aria-label="Đóng">
                <img src="/static/icons/close.svg" width="16" height="16" alt="" aria-hidden="true">
            </button>
        </div>
        <div class="modal-body">
            <form id="nav2-rename-form">
                <input type="hidden" name="peer_id" id="nav2-rename-peer">
                <div class="nav2-form-row">
                    <label for="nav2-rename-alias" style="min-width:68px;color:#6a737d;">Tên mới</label>
                    <input class="nav2-input nav2-input-full" type="text" name="alias" id="nav2-rename-alias"
                           placeholder="Nhập tên thiết bị" required>
                </div>
                <div style="display:flex;gap:8px;justify-content:flex-end;">
                    <button type="button" class="nav2-btn" data-close="nav2-rename">Hủy</button>
                    <button type="submit" class="nav2-btn nav2-primary">Lưu</button>
                </div>
            </form>
        </div>
    </div>
</div>
