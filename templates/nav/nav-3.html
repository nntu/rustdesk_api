<!-- 样式共用 nav2 样式，避免新增 CSS -->
{% load static %}

<div class="nav2-section-title">Quản lý người dùng</div>
<div class="nav2-toolbar" aria-label="Thanh công cụ người dùng">
    <form id="nav3-search-form" role="search" aria-label="Bộ lọc tìm kiếm người dùng">
        <input class="nav2-input" type="text" name="q" value="{{ q|default:'' }}" placeholder="Tìm kiếm tên đăng nhập/email/tên đầy đủ"
               aria-label="Từ khóa tìm kiếm">
        <button type="submit" class="nav2-btn nav2-primary">Tìm kiếm</button>
        <button type="button" class="nav2-btn nav3-reset-btn">Đặt lại</button>
    </form>
    <button type="button" class="nav2-btn nav2-primary nav3-create-btn" style="margin-left: auto;">Tạo người dùng mới</button>
</div>

{% if users %}
    <div class="x-scroll-container">
        <table class="nav2-table" aria-label="Danh sách người dùng" data-table-id="nav3-users">
            <thead>
            <tr>
                <th data-col-key="username" style="width: 70px;">Tên đăng nhập</th>
                <th data-col-key="full_name" style="width: 90px;">Tên đầy đủ</th>
                <th data-col-key="email" style="width: 180px;">Email</th>
                <th data-col-key="is_active" style="width: 100px;">Trạng thái</th>
                <th data-col-key="is_staff" style="width: 100px;">Quản trị viên</th>
                <th data-col-key="last_login" style="width: 180px;">Đăng nhập lần cuối</th>
                <th data-col-key="date_joined" style="width: 180px;">Thời gian tạo</th>
                <th data-col-key="actions" style="width: 240px;">Thao tác</th>
            </tr>
            </thead>
            <tbody>
            {% for u in users %}
                <tr>
                    <td>{{ u.username }}</td>
                    <td>{{ u.get_full_name|default:'-' }}</td>
                    <td>{{ u.email|default:'-' }}</td>
                    <td>
                        {% if u.is_active %}
                            <span class="nav2-status online">Bình thường</span>
                        {% else %}
                            <span class="nav2-status offline">Đã xóa</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if u.is_staff %}
                            <span class="nav2-status online">Có</span>
                        {% else %}
                            <span class="nav2-status offline">Không</span>
                        {% endif %}
                    </td>
                    <td>{{ u.last_login|date:"Y-m-d H:i:s"|default:'-' }}</td>
                    <td>{{ u.date_joined|date:"Y-m-d H:i:s" }}</td>
                    <td>
                        <div class="nav2-row-actions">
                            <button type="button"
                                    class="nav2-btn nav3-row-action"
                                    data-action="edit"
                                    data-username="{{ u.username }}"
                                    data-fullname="{{ u.get_full_name|default:'' }}"
                                    data-email="{{ u.email|default:'' }}"
                                    data-is_staff="{% if u.is_staff %}1{% else %}0{% endif %}">Chỉnh sửa
                            </button>
                            <button type="button"
                                    class="nav2-btn nav3-row-action"
                                    data-action="reset_pwd"
                                    data-username="{{ u.username }}">Đặt lại mật khẩu
                            </button>
                            {% if u.id != 1 %}
                                <button type="button"
                                        class="nav2-btn nav3-row-action"
                                        data-action="delete"
                                        data-username="{{ u.username }}">Xóa
                                </button>
                            {% endif %}
                        </div>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="nav2-pagination">
        <button class="nav2-btn nav3-page-btn" data-key="nav-3"
                {% if page_obj.has_previous %}data-page="{{ page_obj.previous_page_number }}"{% else %}data-page=""
                disabled{% endif %}>Trang trước
        </button>
        <span style="color:#6a737d;">Trang {{ page_obj.number }} / {{ paginator.num_pages }} (tổng {{ paginator.count }} bản ghi)</span>
        <button class="nav2-btn nav3-page-btn" data-key="nav-3"
                {% if page_obj.has_next %}data-page="{{ page_obj.next_page_number }}"{% else %}data-page=""
                disabled{% endif %}>Trang sau
        </button>
    </div>
{% else %}
    <div class="nav2-empty">Chưa có dữ liệu người dùng</div>
{% endif %}

<!-- 编辑用户弹框 -->
<div id="nav3-edit-root" class="modal-backdrop" aria-hidden="true">
    <div class="modal modal--sm" role="dialog" aria-modal="true" aria-labelledby="nav3-edit-title">
        <div class="modal-header">
            <h3 id="nav3-edit-title" class="modal-title">Chỉnh sửa người dùng</h3>
            <button type="button" class="modal-close" data-close="nav3-edit" aria-label="Đóng">
                <img src="/static/icons/close.svg" width="16" height="16" alt="" aria-hidden="true">
            </button>
        </div>
        <div class="modal-body">
            <form id="nav3-edit-form">
                <div class="nav2-form-row">
                    <label style="min-width:88px;color:#6a737d;">Tên đăng nhập</label>
                    <input class="nav2-input nav2-input-full" type="text" name="username" id="nav3-edit-username"
                           readonly>
                </div>
                <div class="nav2-form-row">
                    <label style="min-width:88px;color:#6a737d;">Tên đầy đủ</label>
                    <input class="nav2-input nav2-input-full" type="text" name="full_name" id="nav3-edit-fullname"
                           placeholder="Vui lòng nhập tên đầy đủ">
                </div>
                <div class="nav2-form-row">
                    <label style="min-width:88px;color:#6a737d;">Email</label>
                    <input class="nav2-input nav2-input-full" type="email" name="email" id="nav3-edit-email"
                           placeholder="Vui lòng nhập email">
                </div>
                <div class="nav2-form-row" style="align-items:center;">
                    <label for="nav3-edit-is-staff" style="min-width:88px;color:#6a737d;">Quản trị viên</label>
                    <input type="checkbox" id="nav3-edit-is-staff" name="is_staff" value="1">
                </div>
                <div style="display:flex;gap:8px;justify-content:flex-end;">
                    <button type="button" class="nav2-btn" data-close="nav3-edit">Hủy</button>
                    <button type="submit" class="nav2-btn nav2-primary">Lưu</button>
                </div>
            </form>
        </div>
    </div>
    <!-- 点击遮罩关闭 -->
</div>

<!-- 重置密码弹框 -->
<div id="nav3-reset-root" class="modal-backdrop" aria-hidden="true">
    <div class="modal modal--sm" role="dialog" aria-modal="true" aria-labelledby="nav3-reset-title">
        <div class="modal-header">
            <h3 id="nav3-reset-title" class="modal-title">Đặt lại mật khẩu</h3>
            <button type="button" class="modal-close" data-close="nav3-reset" aria-label="Đóng">
                <img src="/static/icons/close.svg" width="16" height="16" alt="" aria-hidden="true">
            </button>
        </div>
        <div class="modal-body">
            <form id="nav3-reset-form">
                <input type="hidden" name="username" id="nav3-reset-username">
                <div class="nav2-form-row">
                    <label for="nav3-reset-pass1" style="min-width:88px;color:#6a737d;">Mật khẩu mới</label>
                    <input class="nav2-input nav2-input-full" type="password" name="password1" id="nav3-reset-pass1"
                           placeholder="Vui lòng nhập mật khẩu mới" required>
                </div>
                <div class="nav2-form-row">
                    <label for="nav3-reset-pass2" style="min-width:88px;color:#6a737d;">Xác nhận mật khẩu</label>
                    <input class="nav2-input nav2-input-full" type="password" name="password2" id="nav3-reset-pass2"
                           placeholder="Vui lòng nhập lại mật khẩu mới" required>
                </div>
                <div style="display:flex;gap:8px;justify-content:flex-end;">
                    <button type="button" class="nav2-btn" data-close="nav3-reset">Hủy</button>
                    <button type="submit" class="nav2-btn nav2-primary">Xác nhận</button>
                </div>
            </form>
        </div>
    </div>
</div>


<!-- 新建用户弹框 -->
<div id="nav3-create-root" class="modal-backdrop" aria-hidden="true">
    <div class="modal modal--sm" role="dialog" aria-modal="true" aria-labelledby="nav3-create-title">
        <div class="modal-header">
            <h3 id="nav3-create-title" class="modal-title">Tạo người dùng mới</h3>
            <button type="button" class="modal-close" data-close="nav3-create" aria-label="Đóng">
                <img src="/static/icons/close.svg" width="16" height="16" alt="" aria-hidden="true">
            </button>
        </div>
        <div class="modal-body">
            <form id="nav3-create-form">
                <div class="nav2-form-row">
                    <label for="nav3-create-username" style="min-width:88px;color:#6a737d;">Tên đăng nhập *</label>
                    <input class="nav2-input nav2-input-full" type="text" name="username" id="nav3-create-username"
                           placeholder="Vui lòng nhập tên đăng nhập" required>
                </div>
                <div class="nav2-form-row">
                    <label for="nav3-create-fullname" style="min-width:88px;color:#6a737d;">Tên đầy đủ</label>
                    <input class="nav2-input nav2-input-full" type="text" name="full_name" id="nav3-create-fullname"
                           placeholder="Vui lòng nhập tên đầy đủ">
                </div>
                <div class="nav2-form-row">
                    <label for="nav3-create-email" style="min-width:88px;color:#6a737d;">Email</label>
                    <input class="nav2-input nav2-input-full" type="email" name="email" id="nav3-create-email"
                           placeholder="Vui lòng nhập email">
                </div>
                <div class="nav2-form-row">
                    <label for="nav3-create-pass1" style="min-width:88px;color:#6a737d;">Mật khẩu *</label>
                    <input class="nav2-input nav2-input-full" type="password" name="password1" id="nav3-create-pass1"
                           placeholder="Vui lòng nhập mật khẩu (tối thiểu 6 ký tự)" required>
                </div>
                <div class="nav2-form-row">
                    <label for="nav3-create-pass2" style="min-width:88px;color:#6a737d;">Xác nhận mật khẩu *</label>
                    <input class="nav2-input nav2-input-full" type="password" name="password2" id="nav3-create-pass2"
                           placeholder="Vui lòng nhập lại mật khẩu" required>
                </div>
                <div class="nav2-form-row" style="align-items:center;">
                    <label for="nav3-create-is-staff" style="min-width:88px;color:#6a737d;">Quản trị viên</label>
                    <input type="checkbox" id="nav3-create-is-staff" name="is_staff" value="1">
                </div>
                <div style="display:flex;gap:8px;justify-content:flex-end;">
                    <button type="button" class="nav2-btn" data-close="nav3-create">Hủy</button>
                    <button type="submit" class="nav2-btn nav2-primary">Tạo</button>
                </div>
            </form>
        </div>
    </div>
</div>

